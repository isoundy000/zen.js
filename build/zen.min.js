!function(t){var e=t.zen=t.zen||{global:t},r=function(){},i=function(t,e){r.prototype=e.prototype,t.superClass=e.prototype,t.prototype=new r,t.prototype.constructor=t};e.inherit=i;var o=function(){if(!t.navigator)return!0;var e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("mobile")||-1!=e.indexOf("android")};e.isMobile=o;var n=function(t,e){var r=["","WEBKIT_","MOZ_"],i=null;for(var o in r)if(i=t.getExtension(r[o]+e))break;return i};e.getExtension=n}(window),function(){var t={TEXTURE:0,RECT:1,BLEND:2,FILTERS_PUSH:3,FILTERS_POP:4,MASK_PUSH:5,MASK_POP:6};zen.RENDER_CMD=t;var e={CONTAINER:0,RECT:1,SPRITE:2,TEXT:3};zen.DISPLAY_TYPE=e;var r={SOURCE_OVER:["ONE","ONE_MINUS_SRC_ALPHA"],LIGHTER:["SRC_ALPHA","ONE"],DESTINATION_OUT:["ZERO","ONE_MINUS_SRC_ALPHA"],DESTINATION_IN:["ZERO","SRC_ALPHA"],ADD:["ONE","DST_ALPHA"],MULTIPLY:["DST_COLOR","ONE_MINUS_SRC_ALPHA"],SCREEN:["ONE","ONE_MINUS_SRC_COLOR"]};zen.BLEND_MODE=r;var i={EXACT_FIT:0,SHOW_ALL:1,NO_BORDER:2,FIXED_WIDTH:3,FIXED_HEIGHT:4};zen.RESOLUTION_POLICY=i}(),function(){var t=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0};t._pool=[],t.create=function(){return matrix=t._pool.pop()||new t},t.release=function(e){e.identify(),t._pool.push(e)},t.prototype.identify=function(){this.a=this.d=1,this.b=this.c=this.tx=this.ty=0},t.prototype.set=function(t,e,r,i,o,n){this.a=t,this.b=e,this.c=r,this.d=i,this.tx=o,this.ty=n},t.prototype.rotate=function(t){if(t=+t,0!==t){var e=Math.cos(t),r=Math.sin(t),i=this.a,o=this.b,n=this.c,a=this.d,s=this.tx,h=this.ty;this.a=i*e-o*r,this.b=i*r+o*e,this.c=n*e-a*r,this.d=n*r+a*e,this.tx=s*e-h*r,this.ty=s*r+h*e}},t.prototype.scale=function(t,e){1!==t&&(this.a*=t,this.c*=t,this.tx*=t),1!==e&&(this.b*=e,this.d*=e,this.ty*=e)},t.prototype.translate=function(t,e){this.tx+=t,this.ty+=e},t.prototype.append=function(t){var e=this.a,r=this.b,i=this.c,o=this.d,n=this.tx,a=this.ty;1!=e||0!=r||0!=i||1!=o?(this.a=e*t.a+i*t.b,this.b=r*t.a+o*t.b,this.c=e*t.c+i*t.d,this.d=r*t.c+o*t.d,this.tx=e*t.tx+i*t.ty+n,this.ty=r*t.tx+o*t.ty+a):(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx+n,this.ty=t.ty+a)},t.prototype.prepend=function(t){var e=this.a,r=this.b,i=this.c,o=this.d,n=this.tx,a=this.ty;this.a=t.a*e+t.c*r,this.b=t.b*e+t.d*r,this.c=t.a*i+t.c*o,this.d=t.b*i+t.d*o,this.tx=t.a*n+t.c*a+t.tx,this.ty=t.b*n+t.d*a+t.ty},t.prototype.copy=function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty},t.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,i=this.d,o=this.tx,n=this.ty;if(0==e&&0==r)return this.b=this.c=0,void(0==t||0==i?this.a=this.d=this.tx=this.ty=0:(t=this.a=1/t,i=this.d=1/i,this.tx=-t*o,this.ty=-i*n));var a=t*i-e*r;if(0==a)return void this.identity();a=1/a;var s=this.a=i*a;e=this.b=-e*a,r=this.c=-r*a,i=this.d=t*a,this.tx=-(s*o+r*n),this.ty=-(e*o+i*n)},t.prototype.setTransform=function(t,e,r,i,o,n,a){var s=1,h=0;if(o%360){var c=o;s=Math.cos(c),h=Math.sin(c)}this.a=s*r,this.b=h*r,this.c=-h*i,this.d=s*i,this.tx=t,this.ty=e,(n||a)&&(this.tx-=n*this.a+a*this.c,this.ty-=n*this.b+a*this.d)},zen.Matrix=t}(),function(){var t=function(t,e,r,i){this.set(t,e,r,i)};t.prototype.set=function(t,e,r,i){this.x=t||0,this.y=e||0,this.width=r||0,this.height=i||0},t.prototype.copy=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.contains=function(t,e){return t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height},zen.Rectangle=t}(),function(){var t=function(t,e){this.set(t,e)};t.prototype.set=function(t,e){this.x=t||0,this.y=e||0},t.prototype.identify=function(){this.set(0,0)},t.prototype.copy=function(t){this.x=t.x,this.y=t.y},t.prototype.transform=function(t){var e=this.x,r=this.y;this.x=t.a*e+t.c*r+t.tx,this.y=t.b*e+t.d*r+t.ty},t._pool=[],t.create=function(){return t._pool.pop()||new t},t.release=function(t){t.identify(),t._pool.push(matrix)},t.tempVec2=new t,zen.Vec2=t}(),function(){var t={};t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840,t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841,t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842,t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843,t.parse=function(e,r,i){var o=13,n=new Uint32Array(e,0,o),a={buffer:e,header:n};55727696===n[0]?t._parseV3(a,r,i):559044176===n[11]?t._parseV2(a,r,i):i(a,"pvr parse error!")},t._parseV2=function(e,r,i){var o,n,a=e.header,s=a[0],h=a[1],c=a[2],u=a[3],l=a[4],o=(a[5],a[6]),d=(a[7],a[8],a[9],a[10]),p=(a[11],a[12]),f=255,v=24,g=25,m=l&f,x=d>0;m===g?(n=x?t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,o=4):m===v?(n=x?t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,o=2):(i(e,"pvr v2 parse error"),console.log("unknow format flags::"+m));var _=s;e.pvrtcData=new Uint8Array(e.buffer,_),e.bpp=o,e.format=n,e.width=c,e.height=h,e.surfacesCount=p,e.mipmapsCount=u+1,e.isCubemap=6===e.surfacesCount,r(e)},t._parseV3=function(e,r,i){var o,n,a=e.header,s=a[2];switch(s){case 0:o=2,n=t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;break;case 1:o=2,n=t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;break;case 2:o=4,n=t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;break;case 3:o=4,n=t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;break;default:i(e,"pvr v3 parse error"),console.log("unknow pixel format::"+s)}var h=52+a[12];e.pvrtcData=new Uint8Array(e.buffer,h),e.bpp=o,e.format=n,e.width=a[7],e.height=a[6],e.surfacesCount=a[10],e.mipmapsCount=a[11],e.isCubemap=6===e.surfacesCount,r(e)},zen.PVRParser=t}(),function(){function t(t,e,r){switch(t){case zen.PVRParser.COMPRESSED_RGB_PVRTC_4BPPV1_IMG:case zen.PVRParser.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:return Math.floor((Math.max(e,8)*Math.max(r,8)*4+7)/8);case zen.PVRParser.COMPRESSED_RGB_PVRTC_2BPPV1_IMG:case zen.PVRParser.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:return Math.floor((Math.max(e,16)*Math.max(r,8)*2+7)/8);default:return 0}}var e=function(t){this.gl=t,this.width=0,this.height=0,this.isInit=!1,this.glTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.glTexture),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)};e.prototype.uploadImage=function(t,e){var r=this.gl;e&&r.bindTexture(r.TEXTURE_2D,this.glTexture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),this.width=t.width,this.height=t.height,this.isInit=!0},e.prototype.uploadCompressedData=function(r,i,o,n,a,s){var h=this.gl;if(!e.pvrtcExt){var c=zen.getExtension(h,"WEBGL_compressed_texture_pvrtc");if(!c)return void console.log("WEBGL_compressed_texture_pvrtc is not supported!");e.pvrtcExt=c}s&&h.bindTexture(h.TEXTURE_2D,this.glTexture),this.width=i,this.height=o;for(var u=0,l=0;n>l;++l){var d=t(a,i,o),p=new Uint8Array(r.buffer,r.byteOffset+u,d);h.compressedTexImage2D(h.TEXTURE_2D,l,a,i,o,0,p),i>>=1,1>i&&(i=1),o>>=1,1>o&&(o=1),u+=d}this.isInit=!0},e.fromImage=function(t,r){var i=new e(t);return i.uploadImage(r),i},e.fromSrc=function(t,r){return-1!=r.indexOf(".pvr")?e.fromPVRSrc(t,r):e.fromImageSrc(t,r)},e.fromImageSrc=function(t,r){var i=new e(t),o=new Image;return o.src=r,o.onload=function(){i.uploadImage(o,!0)},i},e.fromPVRSrc=function(t,r){var i=new e(t),o=new XMLHttpRequest;return o.addEventListener("load",function(t){200==o.status?zen.PVRParser.parse(o.response,function(t){i.uploadCompressedData(t.pvrtcData,t.width,t.height,t.surfacesCount,t.format,!0)},function(t,e){console.log(t,e)}):console.log("pvr load fails!")},!1),o.open("GET",r,!0),o.responseType="arraybuffer",o.send(null),i},e.pvrtcExt=null,zen.Texture=e}(),function(){var t=function(e,r,i){t.superClass.constructor.call(this,e),r&&i&&this.resize(r,i)};zen.inherit(t,zen.Texture),t.prototype.resize=function(t,e,r){var i=this.gl;r&&i.bindTexture(i.TEXTURE_2D,this.glTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null),this.width=t,this.height=e,this.isInit=!0},zen.RenderTexture=t}(),function(){var t=function(){this.cmd=null,this.texture=null,this.color=0,this.transform=null,this.count=0,this.blendMode="",this.filter=null,this.mask=null};t.pool=[];for(var e=0;300>e;e++)t.pool.push(new t);t.getObject=function(){return t.pool.length>0?t.pool.pop():new t},t.returnObject=function(e){e.cmd=null,e.texture=null,e.color=0,e.transform=null,e.count=0,e.blendMode="",e.filter=null,e.mask=null,t.pool.push(e)},zen.DrawData=t}(),function(){var t=zen.BLEND_MODE,e=zen.DISPLAY_TYPE,r=zen.RENDER_CMD,i=function(e){this.view=e,this.gl=e.getContext("webgl",{antialias:!1,stencil:!0}),this.width=e.clientWidth,this.height=e.clientHeight,this.rootRenderTarget=new zen.RenderTarget(this.gl,this.width,this.height,!0),this.currentRenderTarget=null,this.activateRenderTarget(this.rootRenderTarget),this.rootRenderBuffer=new zen.RenderBuffer(this.gl),this.currentRenderBuffer=null,this.activateRenderBuffer(this.rootRenderBuffer),this.textureShader=new zen.TextureShader(this.gl),this.primitiveShader=new zen.PrimitiveShader(this.gl),this.colorTransformShader=new zen.ColorTransformShader(this.gl),this.currentShader=null,this.drawCall=0,this.defaultBlendMode=t.SOURCE_OVER,this.filtersStack=[],this.maskCount=0;var r=this.gl;r.disable(r.STENCIL_TEST),r.disable(r.DEPTH_TEST),r.enable(r.BLEND),this.setBlendMode(this.defaultBlendMode)};Object.defineProperties(i.prototype,{context:{get:function(){return this.gl}}}),i.prototype.activateShader=function(t){if(this.currentShader!=t){var e=this.gl;t.activate(e),t.setProjection(e,this.currentRenderTarget.projectionMatrix),this.currentShader=t}},i.prototype.activateRenderTarget=function(t){if(this.currentRenderTarget!=t){if(this.currentShader){var e=this.gl;this.currentShader.setProjection(e,t.projectionMatrix)}t.activate(),this.currentRenderTarget=t}},i.prototype.activateRenderBuffer=function(t){this.currentRenderBuffer!=t&&(t.activate(),this.currentRenderBuffer=t)},i.prototype.render=function(t){return this.drawCall=0,this._render(t),this.flush(),this.drawCall},i.prototype._render=function(t){var r=this.currentRenderBuffer.transform,i=t.parentTransform;i.copy(r),r.append(t.getTransformMatrix()),t.blend!=this.defaultBlendMode&&this.currentRenderBuffer.cacheBlendMode(t.blend);var o=null;if(t.filters.length>0&&(o=zen.Matrix.create(),o.copy(r),r.identify(),this.currentRenderBuffer.cacheFiltersPush(t.filters,t.width,t.height)),t.mask){var n=t.mask;this.currentRenderBuffer.cacheQuad(this,n.x,n.y,n.width,n.height,r),this.currentRenderBuffer.cacheMaskPush(t.mask)}if(t.type==e.CONTAINER)for(var a=t.children.length,s=0;a>s;s++){var h=t.children[s];this._render(h)}else this.currentRenderBuffer.cache(this,t);if(t.blend!=this.defaultBlendMode&&this.currentRenderBuffer.cacheBlendMode(this.defaultBlendMode),t.mask){var n=t.mask;this.currentRenderBuffer.cacheQuad(this,n.x,n.y,n.width,n.height,r),this.currentRenderBuffer.cacheMaskPop()}if(t.filters.length>0){for(var s=0;s<t.filters.length-1;s++)this.currentRenderBuffer.cacheQuad(this,0,0,t.width,t.height,r);r.copy(o),zen.Matrix.release(o),this.currentRenderBuffer.cacheQuad(this,0,0,t.width,t.height,r),this.currentRenderBuffer.cacheFiltersPop()}r.copy(i)},i.prototype.flush=function(){this.drawWebGL(),this.currentRenderBuffer.clear()},i.prototype.drawWebGL=function(){var t=this.gl;this.currentRenderBuffer.upload();for(var e=0,i=this.currentRenderBuffer.drawData,o=i.length,n=0;o>n;n++){var a=i[n];switch(a.cmd){case r.TEXTURE:var s=a.count;a.texture&&a.texture.isInit&&(this.activateShader(this.textureShader),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a.texture.glTexture),t.drawElements(t.TRIANGLES,6*s,t.UNSIGNED_SHORT,2*e),this.drawCall++),e+=6*s;break;case r.RECT:var s=a.count;this.activateShader(this.primitiveShader),this.primitiveShader.fillColor(t,a.color),t.drawElements(t.TRIANGLES,6*s,t.UNSIGNED_SHORT,2*e),this.drawCall++,e+=6*s;break;case r.BLEND:var h=a.blendMode;this.setBlendMode(h);break;case r.FILTERS_PUSH:var c=a.filters;0==this.filtersStack.length&&this.filtersStack.push({filters:null,renderTarget:this.currentRenderTarget});var u=zen.RenderTarget.create(this.gl,a.width,a.height);this.filtersStack.push({filters:c,renderTarget:u}),this.activateRenderTarget(u);break;case r.FILTERS_POP:var l=this.filtersStack.pop(),d=this.filtersStack[this.filtersStack.length-1],c=l.filters,p=c.length,f=l.renderTarget;if(p>1)for(var v=0;p-1>v;v++){var g=c[v],m=zen.RenderTarget.create(t,f.width,f.height);e=g.applyFilter(this,f,m,e),zen.RenderTarget.release(f),f=m}var g=c[c.length-1],u=d.renderTarget;e=g.applyFilter(this,f,u,e),zen.RenderTarget.release(f);break;case r.MASK_PUSH:var s=1;0==this.maskCount&&(t.enable(t.STENCIL_TEST),t.clear(t.STENCIL_BUFFER_BIT));var x=this.maskCount;this.maskCount++,t.colorMask(!1,!1,!1,!1),t.stencilFunc(t.EQUAL,x,255),t.stencilOp(t.KEEP,t.KEEP,t.INCR),this.activateShader(this.primitiveShader),this.primitiveShader.fillColor(t,0),t.drawElements(t.TRIANGLES,6*s,t.UNSIGNED_SHORT,2*e),t.stencilFunc(t.EQUAL,x+1,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),this.drawCall++,e+=6*s;break;case r.MASK_POP:var s=1,x=this.maskCount;this.maskCount--,t.colorMask(!1,!1,!1,!1),t.stencilFunc(t.EQUAL,x,255),t.stencilOp(t.KEEP,t.KEEP,t.DECR),this.activateShader(this.primitiveShader),this.primitiveShader.fillColor(t,0),t.drawElements(t.TRIANGLES,6*s,t.UNSIGNED_SHORT,2*e),t.stencilFunc(t.EQUAL,x-1,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),0==this.maskCount&&t.disable(t.STENCIL_TEST),this.drawCall++,e+=6*s;break;default:console.warn("no render type function!")}}t.bindTexture(t.TEXTURE_2D,null)},i.prototype.applyFilter=function(t,e,r,i){var o=this.gl;this.activateRenderTarget(r);var n=1;return o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,e.texture.glTexture),o.drawElements(o.TRIANGLES,6*n,o.UNSIGNED_SHORT,2*i),this.drawCall++,i+=6*n},i.prototype.setBlendMode=function(t){var e=this.gl;t&&2==t.length?e.blendFunc(e[t[0]],e[t[1]]):console.log("blend mode not found!")},i.prototype.clear=function(){this.currentRenderTarget.clear()},zen.Render=i}(),function(){var t=function(t,e,r,i){this.gl=t,this.root=i,this.frameBuffer=null,this.texture=null,this.width=e,this.height=r,this.clearColor=[0,0,0,0],this.projectionMatrix=new Float32Array(9),this.root||(this.frameBuffer=t.createFramebuffer(),this.texture=new zen.RenderTexture(t,e,r),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture.glTexture,0))};t._pool=[],t.create=function(e,r,i){var o=t._pool.pop();return o?(o.width==r&&o.height==i?o.clear(!0):o.resize(r,i),o):new t(e,r,i)},t.release=function(e){t._pool.push(e)},t.prototype.resize=function(t,e){this.width=t,this.height=e,this.texture.resize(t,e,!0)},t.prototype.clear=function(t){var e=this.gl;t&&e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),e.clear(e.COLOR_BUFFER_BIT)},t.prototype.attachStencilBuffer=function(){},t.prototype.activate=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),this.calculateProjection(),t.viewport(0,0,this.width,this.height)},t.prototype.calculateProjection=function(){var t=this.projectionMatrix;this.root?(t[0]=1/this.width*2,t[4]=-1/this.height*2,t[6]=-1,t[7]=1):(t[0]=1/this.width*2,t[4]=1/this.height*2,t[6]=-1,t[7]=-1)},t.prototype.destroy=function(){},zen.RenderTarget=t}(),function(){var t=zen.DISPLAY_TYPE,e=zen.RENDER_CMD,r=function(t){this.gl=t,this.verticesCount=0,this.maxVerticesIndex=4e4,this.maxIndicesIndex=12e3,this.verticesIndex=0,this.indicesIndex=0,this.drawData=[],this.vertices=new Float32Array(this.maxVerticesIndex),this.vertexBuffer=t.createBuffer(),this.indices=new Uint16Array(this.maxIndicesIndex),this.indexBuffer=t.createBuffer(),this.transform=new zen.Matrix};r.prototype.activate=function(){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)},r.prototype.upload=function(){var t=this.gl,e=this.vertices.subarray(0,this.verticesIndex);t.bufferData(t.ARRAY_BUFFER,e,t.STREAM_DRAW);var r=this.indices.subarray(0,this.indicesIndex);t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW)},r.prototype.reachedMaxSize=function(t,e){var r=t||4,i=e||6;return this.verticesIndex>=this.maxVerticesIndex-r||this.indicesIndex>=this.maxIndicesIndex-i},r.prototype.cache=function(r,i){var o=this.transform,n=i.getCoords(),a=i.getProps(),s=i.getIndices();this.cacheVerticesAndIndices(r,n,a,s,o);var h=i.type,c=null;switch(h){case t.SPRITE:(i.filters.length>0||0==this.drawData.length||this.drawData[this.drawData.length-1].cmd!=e.TEXTURE||this.drawData[this.drawData.length-1].texture!=i.texture)&&(c=zen.DrawData.getObject(),c.texture=i.texture,c.filters=i.filters,c.cmd=e.TEXTURE,this.drawData.push(c)),this.drawData[this.drawData.length-1].count++;break;case t.RECT:(i.filters.length>0||0==this.drawData.length||this.drawData[this.drawData.length-1].cmd!=e.RECT||this.drawData[this.drawData.length-1].color!=i.color)&&(c=zen.DrawData.getObject(),c.color=i.color,c.cmd=e.RECT,this.drawData.push(c)),this.drawData[this.drawData.length-1].count++;break;case t.TEXT:var c=zen.DrawData.getObject();i.dirty&&(i.updateTexture(),i.dirty=!1),c.texture=i.texture,c.filters=i.filters,c.cmd=e.TEXTURE,this.drawData.push(c),this.drawData[this.drawData.length-1].count++;break;default:console.warn("no render type function")}},r.prototype.cacheBlendMode=function(t){if(this.drawData.length>0)for(var r=!1,i=this.drawData.length-1;i>=0;i--){var o=this.drawData[i];if(o.cmd!=e.BLEND&&(r=!0),r||o.cmd!=e.BLEND){if(o.cmd==e.BLEND){if(o.blendMode==t)return;break}}else this.drawData.splice(i,1)}var o=zen.DrawData.getObject();o.cmd=e.BLEND,o.blendMode=t,this.drawData.push(o)},r.prototype.cacheFiltersPush=function(t,r,i){var o=zen.DrawData.getObject();o.cmd=e.FILTERS_PUSH,o.filters=t,o.width=r,o.height=i,this.drawData.push(o)},r.prototype.cacheFiltersPop=function(){var t=zen.DrawData.getObject();t.cmd=e.FILTERS_POP,this.drawData.push(t)},r.prototype.cacheMaskPush=function(t){var r=zen.DrawData.getObject();r.cmd=e.MASK_PUSH,r.mask=t,this.drawData.push(r)},r.prototype.cacheMaskPop=function(){var t=zen.DrawData.getObject();t.cmd=e.MASK_POP,this.drawData.push(t)},r.prototype.cacheQuad=function(t,e,r,i,o,n){var a=[e,r,e+i,r,e+i,r+o,e,r+o],s=[0,0,1,0,1,1,0,1],h=[0,1,2,2,3,0];this.cacheVerticesAndIndices(t,a,s,h,n)},r.prototype.cacheVerticesAndIndices=function(t,e,r,i,o){var n=2,a=e.length,s=r.length,h=i.length,c=a/n,u=s/c,l=n+u;this.reachedMaxSize(a+s,h)&&t.flush();for(var d=this.verticesCount,p=this.verticesIndex,f=this.indicesIndex,v=o,g=0,m=0,x=this.vertices,_=0;c>_;_++){g=e[_*n+0],m=e[_*n+1],x[p+_*l+0]=v.a*g+v.c*m+v.tx,x[p+_*l+1]=v.b*g+v.d*m+v.ty;for(var T=p+_*l+n,y=_*u,C=0;u>C;C++)x[T+C]=r[y+C]}for(var S=this.indices,_=0,E=h;E>_;_++)S[f+_]=i[_]+d;this.verticesCount+=c,this.verticesIndex+=c*l,this.indicesIndex+=h},r.prototype.clear=function(){for(var t=0;t<this.drawData.length;t++)zen.DrawData.returnObject(this.drawData[t]);this.drawData.length=0,this.verticesCount=0,this.verticesIndex=0,this.indicesIndex=0},zen.RenderBuffer=r}(),function(){var t=function(t,e,r){this.vshaderSource=e,this.fshaderSource=r,this.vertexShader=this._loadShader(t,t.VERTEX_SHADER,this.vshaderSource),this.fragmentShader=this._loadShader(t,t.FRAGMENT_SHADER,this.fshaderSource),this.program=this._createProgram(t)};t.prototype.activate=function(t){t.useProgram(this.program)},t.prototype.setProjection=function(t,e){var r=t.getUniformLocation(this.program,"u_Projection");t.uniformMatrix3fv(r,!1,e)},t.prototype._createProgram=function(t){var e=t.createProgram();return t.attachShader(e,this.vertexShader),t.attachShader(e,this.fragmentShader),t.linkProgram(e),e},t.prototype._loadShader=function(t,e,r){var i=t.createShader(e);t.shaderSource(i,r),t.compileShader(i);var o=t.getShaderParameter(i,t.COMPILE_STATUS);return o||(console.log("shader not compiled!"),console.log(t.getShaderInfoLog(i))),i},zen.Shader=t}(),function(){var t=function(e){var r=["attribute vec2 a_Position;","uniform mat3 u_Projection;","void main() {","gl_Position = vec4((u_Projection * vec3(a_Position, 1.0)).xy, 0.0, 1.0);","}"].join("\n"),i=["precision mediump float;","uniform vec4 u_Color;","void main() {","gl_FragColor = u_Color;","}"].join("\n");t.superClass.constructor.call(this,e,r,i)};zen.inherit(t,zen.Shader),t.prototype.activate=function(e,r,i){t.superClass.activate.call(this,e,r,i);var o=e.getAttribLocation(this.program,"a_Position"),n=4;e.vertexAttribPointer(o,2,e.FLOAT,!1,4*n,0),e.enableVertexAttribArray(o),this.fillColor(e,16776960)},t.prototype.fillColor=function(t,e){var r=t.getUniformLocation(this.program,"u_Color"),i=parseInt(e,10),o=i/65536,n=i%65536/256,a=i%256/1;t.uniform4f(r,o/256,n/256,a/256,1)},zen.PrimitiveShader=t}(),function(){var t=function(e){var r=["attribute vec2 a_Position;","attribute vec2 a_TexCoord;","varying vec2 v_TexCoord;","uniform mat3 u_Projection;","void main() {","gl_Position = vec4((u_Projection * vec3(a_Position, 1.0)).xy, 0.0, 1.0);","v_TexCoord = a_TexCoord;","}"].join("\n"),i=["precision mediump float;","uniform sampler2D u_Sampler;","varying vec2 v_TexCoord;","void main() {","gl_FragColor = texture2D(u_Sampler, v_TexCoord);","}"].join("\n");t.superClass.constructor.call(this,e,r,i)};zen.inherit(t,zen.Shader),t.prototype.activate=function(e,r,i){t.superClass.activate.call(this,e,r,i);var o=e.getAttribLocation(this.program,"a_Position"),n=e.getAttribLocation(this.program,"a_TexCoord"),a=4;e.vertexAttribPointer(o,2,e.FLOAT,!1,4*a,0),e.enableVertexAttribArray(o),e.vertexAttribPointer(n,2,e.FLOAT,!1,4*a,2*a),e.enableVertexAttribArray(n);var s=e.getUniformLocation(this.program,"u_Sampler");e.uniform1i(s,0)},zen.TextureShader=t}(),function(){var t=function(e){var r=["attribute vec2 a_Position;","attribute vec2 a_TexCoord;","varying vec2 v_TexCoord;","uniform mat3 u_Projection;","void main() {","gl_Position = vec4((u_Projection * vec3(a_Position, 1.0)).xy, 0.0, 1.0);","v_TexCoord = a_TexCoord;","}"].join("\n"),i=["precision mediump float;","uniform sampler2D u_Sampler;","varying vec2 v_TexCoord;","uniform mat4 u_Matrix;","uniform vec4 u_ColorAdd;","void main() {","vec4 texColor = texture2D(u_Sampler, v_TexCoord);","vec4 locColor = texColor * u_Matrix;","if (locColor.a != 0.0) {","locColor += u_ColorAdd * locColor.a;","}","gl_FragColor = locColor;","}"].join("\n");t.superClass.constructor.call(this,e,r,i),this.transform=new Float32Array(16),this.colorAdd=new Float32Array(4)};zen.inherit(t,zen.Shader),t.prototype.activate=function(e,r,i){t.superClass.activate.call(this,e,r,i);var o=e.getAttribLocation(this.program,"a_Position"),n=e.getAttribLocation(this.program,"a_TexCoord"),a=4;e.vertexAttribPointer(o,2,e.FLOAT,!1,4*a,0),e.enableVertexAttribArray(o),e.vertexAttribPointer(n,2,e.FLOAT,!1,4*a,2*a),e.enableVertexAttribArray(n);var s=e.getUniformLocation(this.program,"u_Sampler");e.uniform1i(s,0)},t.prototype.setMatrix=function(t,e){var r=t.getUniformLocation(this.program,"u_Matrix"),i=t.getUniformLocation(this.program,"u_ColorAdd");this.transform[0]=e[0],this.transform[1]=e[1],this.transform[2]=e[2],this.transform[3]=e[3],this.transform[4]=e[5],this.transform[5]=e[6],this.transform[6]=e[7],this.transform[7]=e[8],this.transform[8]=e[10],this.transform[9]=e[11],this.transform[10]=e[12],this.transform[11]=e[13],this.transform[12]=e[15],this.transform[13]=e[16],this.transform[14]=e[17],this.transform[15]=e[18],this.colorAdd[0]=e[4]/255,this.colorAdd[1]=e[9]/255,this.colorAdd[2]=e[14]/255,this.colorAdd[3]=e[19]/255,t.uniformMatrix4fv(r,!1,this.transform),t.uniform4fv(i,this.colorAdd)},zen.ColorTransformShader=t}(),function(){var t=function(e){var r=["attribute vec2 a_Position;","attribute vec2 a_TexCoord;","varying vec2 v_TexCoord;","uniform mat3 u_Projection;","void main() {","gl_Position = vec4((u_Projection * vec3(a_Position, 1.0)).xy, 0.0, 1.0);","v_TexCoord = a_TexCoord;","}"].join("\n"),i=["precision mediump float;","varying vec2 v_TexCoord;","uniform sampler2D u_Sampler;","uniform float distance;","uniform float outerStrength;","uniform float innerStrength;","uniform vec4 glowColor;","uniform float pixelWidth;","uniform float pixelHeight;","vec2 px = vec2(1.0 / pixelWidth, 1.0 / pixelHeight);","void main(void) {","const float quality = 8.0;","const float PI = 3.14159265358979323846264;","vec4 ownColor = texture2D(u_Sampler, v_TexCoord);","vec4 curColor;","float totalAlpha = 0.0;","float maxTotalAlpha = 0.0;","float cosAngle;","float sinAngle;","float curDistance = 0.0;","for (float angle = PI * 2.0 / quality; angle <= PI * 2.0; angle += PI * 2.0 / quality) {","cosAngle = cos(angle);","sinAngle = sin(angle);","for (float d = 1.0; d <= quality; d++) {","curDistance = d * distance / quality;","curColor = texture2D(u_Sampler, vec2(v_TexCoord.x + cosAngle * curDistance * px.x, v_TexCoord.y + sinAngle * curDistance * px.y));","totalAlpha += (distance - curDistance) * curColor.a;","maxTotalAlpha += (distance - curDistance);","}","}","maxTotalAlpha = max(maxTotalAlpha, 0.0001);","ownColor.a = max(ownColor.a, 0.0001);","ownColor.rgb = ownColor.rgb / ownColor.a;","float outerGlowAlpha = (totalAlpha / maxTotalAlpha)  * outerStrength * (1. - ownColor.a);","float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * innerStrength * ownColor.a;","vec3 mix1 = mix(ownColor.rgb, glowColor.rgb, innerGlowAlpha / (innerGlowAlpha + ownColor.a));","vec3 mix2 = mix(mix1, glowColor.rgb, outerGlowAlpha / (innerGlowAlpha + ownColor.a + outerGlowAlpha));","float resultAlpha = min(ownColor.a + outerGlowAlpha + innerGlowAlpha, 1.);","gl_FragColor = vec4(mix2 * resultAlpha, resultAlpha);","}"].join("\n");t.superClass.constructor.call(this,e,r,i)};zen.inherit(t,zen.Shader),t.prototype.activate=function(e,r,i){t.superClass.activate.call(this,e,r,i);var o=e.getAttribLocation(this.program,"a_Position"),n=e.getAttribLocation(this.program,"a_TexCoord"),a=4;e.vertexAttribPointer(o,2,e.FLOAT,!1,4*a,0),e.enableVertexAttribArray(o),e.vertexAttribPointer(n,2,e.FLOAT,!1,4*a,2*a),e.enableVertexAttribArray(n);var s=e.getUniformLocation(this.program,"u_Sampler");e.uniform1i(s,0)},t.prototype.setDistance=function(t,e){var r=t.getUniformLocation(this.program,"distance");t.uniform1f(r,e)},t.prototype.setColor=function(t,e){var r=t.getUniformLocation(this.program,"glowColor"),i=parseInt(e,10),o=i/65536,n=i%65536/256,a=i%256/1;t.uniform4f(r,o/256,n/256,a/256,1)},t.prototype.setOuterStrength=function(t,e){var r=t.getUniformLocation(this.program,"outerStrength");t.uniform1f(r,e)},t.prototype.setInnerStrength=function(t,e){var r=t.getUniformLocation(this.program,"innerStrength");t.uniform1f(r,e)},t.prototype.setViewSize=function(t,e,r){var i=t.getUniformLocation(this.program,"pixelWidth");t.uniform1f(i,e);var o=t.getUniformLocation(this.program,"pixelHeight");t.uniform1f(o,r)},zen.GlowShader=t}(),function(){var t=function(e){var r=["attribute vec2 a_Position;","attribute vec2 a_TexCoord;","varying vec2 v_TexCoord;","uniform mat3 u_Projection;","void main() {","gl_Position = vec4((u_Projection * vec3(a_Position, 1.0)).xy, 0.0, 1.0);","v_TexCoord = a_TexCoord;","}"].join("\n"),i=["precision mediump float;","varying vec2 v_TexCoord;","uniform sampler2D u_Sampler;","uniform float thickness;","uniform vec4 outlineColor;","uniform float pixelWidth;","uniform float pixelHeight;","vec2 px = vec2(1. / pixelWidth, 1. / pixelHeight);","void main(void) {","const float quality = 8.;","const float PI = 3.14159265358979323846264;","vec4 ownColor = texture2D(u_Sampler, v_TexCoord);","vec4 curColor;","float maxAlpha = 0.;","for (float angle = (PI * 2.) / quality; angle <= PI * 2.; angle += (PI * 2.) / quality ) {","curColor = texture2D(u_Sampler, vec2(v_TexCoord.x + thickness * px.x * cos(angle), v_TexCoord.y + thickness * px.y * sin(angle)));","maxAlpha = max(maxAlpha, curColor.a);","}","float resultAlpha = max(maxAlpha, ownColor.a);","gl_FragColor = vec4(mix(outlineColor.rgb, ownColor.rgb, ownColor.a / 1.) * resultAlpha, resultAlpha);","}"].join("\n");t.superClass.constructor.call(this,e,r,i)};zen.inherit(t,zen.Shader),t.prototype.activate=function(e,r,i){t.superClass.activate.call(this,e,r,i);var o=e.getAttribLocation(this.program,"a_Position"),n=e.getAttribLocation(this.program,"a_TexCoord"),a=4;e.vertexAttribPointer(o,2,e.FLOAT,!1,4*a,0),e.enableVertexAttribArray(o),e.vertexAttribPointer(n,2,e.FLOAT,!1,4*a,2*a),e.enableVertexAttribArray(n);var s=e.getUniformLocation(this.program,"u_Sampler");e.uniform1i(s,0)},t.prototype.setThickness=function(t,e){var r=t.getUniformLocation(this.program,"thickness");t.uniform1f(r,e)},t.prototype.setColor=function(t,e){var r=t.getUniformLocation(this.program,"outlineColor"),i=parseInt(e,10),o=i/65536,n=i%65536/256,a=i%256/1;t.uniform4f(r,o/256,n/256,a/256,1)},t.prototype.setViewSize=function(t,e,r){var i=t.getUniformLocation(this.program,"pixelWidth");t.uniform1f(i,e);var o=t.getUniformLocation(this.program,"pixelHeight");t.uniform1f(o,r)},zen.OutlineShader=t}(),function(){var t=function(e){var r=["attribute vec2 a_Position;","attribute vec2 a_TexCoord;","varying vec2 v_TexCoord;","uniform mat3 u_Projection;","void main() {","gl_Position = vec4((u_Projection * vec3(a_Position, 1.0)).xy, 0.0, 1.0);","v_TexCoord = a_TexCoord;","}"].join("\n"),i=["precision mediump float;","uniform vec2 u_TextureSize;","uniform float pixelSize;","uniform sampler2D u_Sampler;","varying vec2 v_TexCoord;","float character(float n, vec2 p)","{","p = floor(p*vec2(4.0, -4.0) + 2.5);","if (clamp(p.x, 0.0, 4.0) == p.x && clamp(p.y, 0.0, 4.0) == p.y)","{","if (int(mod(n/exp2(p.x + 5.0*p.y), 2.0)) == 1) return 1.0;","}","return 0.0;","}","void main()","{","vec2 uv = v_TexCoord.xy;","vec2 uvPixel = pixelSize / u_TextureSize;","vec3 col = texture2D(u_Sampler, floor( uv / uvPixel) * uvPixel).rgb;","float gray = (col.r + col.g + col.b) / 3.0;","float n =  65536.0;","if (gray > 0.2) n = 65600.0;","if (gray > 0.3) n = 332772.0;","if (gray > 0.4) n = 15255086.0;","if (gray > 0.5) n = 23385164.0;","if (gray > 0.6) n = 15252014.0;","if (gray > 0.7) n = 13199452.0;","if (gray > 0.8) n = 11512810.0;","vec2 p = mod( uv / ( uvPixel * 0.5 ), 2.0) - vec2(1.0);","col = col * character(n, p);","gl_FragColor = vec4(col, 1.0);","}"].join("\n");t.superClass.constructor.call(this,e,r,i)};zen.inherit(t,zen.Shader),t.prototype.activate=function(e,r,i){t.superClass.activate.call(this,e,r,i);var o=e.getAttribLocation(this.program,"a_Position"),n=e.getAttribLocation(this.program,"a_TexCoord"),a=4;e.vertexAttribPointer(o,2,e.FLOAT,!1,4*a,0),e.enableVertexAttribArray(o),e.vertexAttribPointer(n,2,e.FLOAT,!1,4*a,2*a),e.enableVertexAttribArray(n);var s=e.getUniformLocation(this.program,"u_Sampler");e.uniform1i(s,0)},t.prototype.setTextureSize=function(t,e,r){var i=t.getUniformLocation(this.program,"u_TextureSize");t.uniform2f(i,e,r)},t.prototype.setPixelSize=function(t,e){var r=t.getUniformLocation(this.program,"pixelSize");t.uniform1f(r,e)},zen.AsciiShader=t}(),function(){var t=function(e){var r=["attribute vec2 a_Position;","attribute vec2 a_TexCoord;","varying vec2 v_TexCoord;","uniform mat3 u_Projection;","void main() {","gl_Position = vec4((u_Projection * vec3(a_Position, 1.0)).xy, 0.0, 1.0);","v_TexCoord = a_TexCoord;","}"].join("\n"),i=["precision mediump float;","uniform vec2 u_TextureSize;","uniform float pixelSize;","uniform sampler2D u_Sampler;","varying vec2 v_TexCoord;","vec2 uvPixel = pixelSize / u_TextureSize;","void main()","{","vec2 uv = floor(v_TexCoord / uvPixel) * uvPixel + uvPixel * 0.5;","gl_FragColor = texture2D(u_Sampler, uv);","}"].join("\n");t.superClass.constructor.call(this,e,r,i)};zen.inherit(t,zen.Shader),t.prototype.activate=function(e,r,i){t.superClass.activate.call(this,e,r,i);var o=e.getAttribLocation(this.program,"a_Position"),n=e.getAttribLocation(this.program,"a_TexCoord"),a=4;e.vertexAttribPointer(o,2,e.FLOAT,!1,4*a,0),e.enableVertexAttribArray(o),e.vertexAttribPointer(n,2,e.FLOAT,!1,4*a,2*a),e.enableVertexAttribArray(n);var s=e.getUniformLocation(this.program,"u_Sampler");
e.uniform1i(s,0)},t.prototype.setTextureSize=function(t,e,r){var i=t.getUniformLocation(this.program,"u_TextureSize");t.uniform2f(i,e,r)},t.prototype.setPixelSize=function(t,e){var r=t.getUniformLocation(this.program,"pixelSize");t.uniform1f(r,e)},zen.PixelateShader=t}(),function(){var t=function(e){var r=["attribute vec2 a_Position;","attribute vec2 a_TexCoord;","varying vec2 v_TexCoord;","uniform mat3 u_Projection;","void main() {","gl_Position = vec4((u_Projection * vec3(a_Position, 1.0)).xy, 0.0, 1.0);","v_TexCoord = a_TexCoord;","}"].join("\n"),i=["precision mediump float;","uniform sampler2D u_Sampler;","varying vec2 v_TexCoord;","uniform float u_Blur;","uniform vec2 u_TextureSize;","float blurUv = u_Blur / u_TextureSize.x;","void main() {","vec4 color = vec4(0.0, 0.0, 0.0, 0.0);","color += texture2D(u_Sampler, v_TexCoord + vec2(-3. / 3. * blurUv, 0.)) * 0.004431848411938341;","color += texture2D(u_Sampler, v_TexCoord + vec2(-2. / 3. * blurUv, 0.)) * 0.05399096651318985;","color += texture2D(u_Sampler, v_TexCoord + vec2(-1. / 3. * blurUv, 0.)) * 0.2419707245191454;","color += texture2D(u_Sampler, v_TexCoord + vec2( 0. / 3. * blurUv, 0.)) * 0.3989422804014327;","color += texture2D(u_Sampler, v_TexCoord + vec2( 1. / 3. * blurUv, 0.)) * 0.2419707245191454;","color += texture2D(u_Sampler, v_TexCoord + vec2( 2. / 3. * blurUv, 0.)) * 0.05399096651318985;","color += texture2D(u_Sampler, v_TexCoord + vec2( 3. / 3. * blurUv, 0.)) * 0.004431848411938341;","gl_FragColor = color;","}"].join("\n");t.superClass.constructor.call(this,e,r,i)};zen.inherit(t,zen.Shader),t.prototype.activate=function(e,r,i){t.superClass.activate.call(this,e,r,i);var o=e.getAttribLocation(this.program,"a_Position"),n=e.getAttribLocation(this.program,"a_TexCoord"),a=4;e.vertexAttribPointer(o,2,e.FLOAT,!1,4*a,0),e.enableVertexAttribArray(o),e.vertexAttribPointer(n,2,e.FLOAT,!1,4*a,2*a),e.enableVertexAttribArray(n);var s=e.getUniformLocation(this.program,"u_Sampler");e.uniform1i(s,0)},t.prototype.setBlurX=function(t,e){var r=t.getUniformLocation(this.program,"u_Blur");t.uniform1f(r,e)},t.prototype.setTextureSize=function(t,e,r){var i=t.getUniformLocation(this.program,"u_TextureSize");t.uniform2f(i,e,r)},zen.BlurXShader=t}(),function(){var t=function(e){var r=["attribute vec2 a_Position;","attribute vec2 a_TexCoord;","varying vec2 v_TexCoord;","uniform mat3 u_Projection;","void main() {","gl_Position = vec4((u_Projection * vec3(a_Position, 1.0)).xy, 0.0, 1.0);","v_TexCoord = a_TexCoord;","}"].join("\n"),i=["precision mediump float;","uniform sampler2D u_Sampler;","varying vec2 v_TexCoord;","uniform float u_Blur;","uniform vec2 u_TextureSize;","float blurUv = u_Blur / u_TextureSize.y;","void main() {","vec4 color = vec4(0.0, 0.0, 0.0, 0.0);","color += texture2D(u_Sampler, v_TexCoord + vec2(-3. / 3. * blurUv, 0.)) * 0.004431848411938341;","color += texture2D(u_Sampler, v_TexCoord + vec2(-2. / 3. * blurUv, 0.)) * 0.05399096651318985;","color += texture2D(u_Sampler, v_TexCoord + vec2(-1. / 3. * blurUv, 0.)) * 0.2419707245191454;","color += texture2D(u_Sampler, v_TexCoord + vec2( 0. / 3. * blurUv, 0.)) * 0.3989422804014327;","color += texture2D(u_Sampler, v_TexCoord + vec2( 1. / 3. * blurUv, 0.)) * 0.2419707245191454;","color += texture2D(u_Sampler, v_TexCoord + vec2( 2. / 3. * blurUv, 0.)) * 0.05399096651318985;","color += texture2D(u_Sampler, v_TexCoord + vec2( 3. / 3. * blurUv, 0.)) * 0.004431848411938341;","gl_FragColor = color;","}"].join("\n");t.superClass.constructor.call(this,e,r,i)};zen.inherit(t,zen.Shader),t.prototype.activate=function(e,r,i){t.superClass.activate.call(this,e,r,i);var o=e.getAttribLocation(this.program,"a_Position"),n=e.getAttribLocation(this.program,"a_TexCoord"),a=4;e.vertexAttribPointer(o,2,e.FLOAT,!1,4*a,0),e.enableVertexAttribArray(o),e.vertexAttribPointer(n,2,e.FLOAT,!1,4*a,2*a),e.enableVertexAttribArray(n);var s=e.getUniformLocation(this.program,"u_Sampler");e.uniform1i(s,0)},t.prototype.setBlurY=function(t,e){var r=t.getUniformLocation(this.program,"u_Blur");t.uniform1f(r,e)},t.prototype.setTextureSize=function(t,e,r){var i=t.getUniformLocation(this.program,"u_TextureSize");t.uniform2f(i,e,r)},zen.BlurYShader=t}(),function(){function t(t,e,r){var i=1/Math.sqrt(6.283185308*r*r);return i*Math.exp(-(t*t+e*e)/(2*r*r))}var e=function(r){for(var i=["attribute vec2 a_Position;","attribute vec2 a_TexCoord;","varying vec2 v_TexCoord;","uniform mat3 u_Projection;","void main() {","gl_Position = vec4((u_Projection * vec3(a_Position, 1.0)).xy, 0.0, 1.0);","v_TexCoord = a_TexCoord;","}"].join("\n"),o=3,n=0,a=-o;o>=a;a++)for(var s=-o;o>=s;s++)n+=t(3*a/o,3*s/o,1);for(var h="",a=-o;o>=a;a++)for(var s=-o;o>=s;s++)h+="color += texture2D(u_Sampler, vec2(v_TexCoord.x + "+(a/o).toFixed(5)+" * blurUv.x, v_TexCoord.y + "+(s/o).toFixed(5)+" * blurUv.y)) * "+(t(3*a/o,3*s/o,1)/n).toFixed(7)+";\n";var c=["precision mediump float;","uniform sampler2D u_Sampler;","varying vec2 v_TexCoord;","uniform vec2 u_Blur;","uniform vec2 u_TextureSize;","void main() {","vec2 blurUv = u_Blur / u_TextureSize;","vec4 color = vec4(0.0, 0.0, 0.0, 0.0);","%BLUR_CODE%","gl_FragColor = color;","}"].join("\n").replace("%BLUR_CODE%",h);e.superClass.constructor.call(this,r,i,c)};zen.inherit(e,zen.Shader),e.prototype.activate=function(t,r,i){e.superClass.activate.call(this,t,r,i);var o=t.getAttribLocation(this.program,"a_Position"),n=t.getAttribLocation(this.program,"a_TexCoord"),a=4;t.vertexAttribPointer(o,2,t.FLOAT,!1,4*a,0),t.enableVertexAttribArray(o),t.vertexAttribPointer(n,2,t.FLOAT,!1,4*a,2*a),t.enableVertexAttribArray(n);var s=t.getUniformLocation(this.program,"u_Sampler");t.uniform1i(s,0)},e.prototype.setBlur=function(t,e,r){var i=t.getUniformLocation(this.program,"u_Blur");t.uniform2f(i,e,r)},e.prototype.setTextureSize=function(t,e,r){var i=t.getUniformLocation(this.program,"u_TextureSize");t.uniform2f(i,e,r)},zen.BlurShader=e}(),function(){var t=function(t){this.shader=null};t.prototype.applyFilter=function(t,e,r,i){return i=t.applyFilter(this,e,r,i)},zen.AbstractFilter=t}(),function(){var t=function(t){this.shader=new zen.ColorTransformShader(t),this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]};zen.inherit(t,zen.AbstractFilter),t.prototype.reset=function(){this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]},t.prototype.brightness=function(t){this.matrix=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0]},t.prototype.grayScale=function(t){this.matrix=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0]},t.prototype.blackAndWhite=function(t){this.matrix=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0]},t.prototype.hue=function(t){t=(t||0)/180*Math.PI;var e=Math.cos(t),r=Math.sin(t),i=.213,o=.715,n=.072;this.matrix=[i+e*(1-i)+r*-i,o+e*-o+r*-o,n+e*-n+r*(1-n),0,0,i+e*-i+.143*r,o+e*(1-o)+.14*r,n+e*-n+r*-.283,0,0,i+e*-i+r*-(1-i),o+e*-o+r*o,n+e*(1-n)+r*n,0,0,0,0,0,1,0]},t.prototype.contrast=function(t){var e=(t||0)+1,r=-128*(e-1);this.matrix=[e,0,0,0,r,0,e,0,0,r,0,0,e,0,r,0,0,0,1,0]},t.prototype.saturate=function(t){var e=2*(t||0)/3+1,r=(e-1)*-.5;this.matrix=[e,r,r,0,0,r,e,r,0,0,r,r,e,0,0,0,0,0,1,0]},t.prototype.desaturate=function(t){this.saturate(-1)},t.prototype.negative=function(){this.matrix=[0,1,1,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,1,0]},t.prototype.applyFilter=function(t,e,r,i){return t.activateShader(this.shader),this.shader.setMatrix(t.gl,this.matrix),i=t.applyFilter(this,e,r,i)},zen.ColorTransformFilter=t}(),function(){var t=function(t){this.shader=new zen.GlowShader(t),this.distance=15,this.color=16711680,this.outerStrength=1,this.innerStrength=1};zen.inherit(t,zen.AbstractFilter),t.prototype.applyFilter=function(t,e,r,i){return t.activateShader(this.shader),this.shader.setDistance(t.gl,this.distance),this.shader.setColor(t.gl,this.color),this.shader.setOuterStrength(t.gl,this.outerStrength),this.shader.setInnerStrength(t.gl,this.innerStrength),this.shader.setViewSize(t.gl,e.width,e.height),i=t.applyFilter(this,e,r,i)},zen.GlowFilter=t}(),function(){var t=function(t){this.shader=new zen.OutlineShader(t),this.thickness=4,this.color=16711680};zen.inherit(t,zen.AbstractFilter),t.prototype.applyFilter=function(t,e,r,i){return t.activateShader(this.shader),this.shader.setThickness(t.gl,this.thickness),this.shader.setColor(t.gl,this.color),this.shader.setViewSize(t.gl,e.width,e.height),i=t.applyFilter(this,e,r,i)},zen.OutlineFilter=t}(),function(){var t=function(t){this.shader=new zen.AsciiShader(t),this.pixelSize=10};zen.inherit(t,zen.AbstractFilter),t.prototype.applyFilter=function(t,e,r,i){return t.activateShader(this.shader),this.shader.setPixelSize(t.gl,this.pixelSize),this.shader.setTextureSize(t.gl,e.width,e.height),i=t.applyFilter(this,e,r,i)},zen.AsciiFilter=t}(),function(){var t=function(t){this.shader=new zen.PixelateShader(t),this.pixelSize=10};zen.inherit(t,zen.AbstractFilter),t.prototype.applyFilter=function(t,e,r,i){return t.activateShader(this.shader),this.shader.setPixelSize(t.gl,this.pixelSize),this.shader.setTextureSize(t.gl,e.width,e.height),i=t.applyFilter(this,e,r,i)},zen.PixelateFilter=t}(),function(){var t=function(t){this.shader=new zen.BlurXShader(t),this.blurX=1};zen.inherit(t,zen.AbstractFilter),t.prototype.applyFilter=function(t,e,r,i){return t.activateShader(this.shader),this.shader.setBlurX(t.gl,this.blurX),this.shader.setTextureSize(t.gl,e.width,e.height),i=t.applyFilter(this,e,r,i)},zen.BlurXFilter=t}(),function(){var t=function(t){this.shader=new zen.BlurYShader(t),this.blurY=1};zen.inherit(t,zen.AbstractFilter),t.prototype.applyFilter=function(t,e,r,i){return t.activateShader(this.shader),this.shader.setBlurY(t.gl,this.blurY),this.shader.setTextureSize(t.gl,e.width,e.height),i=t.applyFilter(this,e,r,i)},zen.BlurYFilter=t}(),function(){var t=function(t){this.shader=new zen.BlurShader(t),this.blurX=2,this.blurY=2};zen.inherit(t,zen.AbstractFilter),t.prototype.applyFilter=function(t,e,r,i){return t.activateShader(this.shader),this.shader.setBlur(t.gl,this.blurX,this.blurY),this.shader.setTextureSize(t.gl,e.width,e.height),i=t.applyFilter(this,e,r,i)},zen.BlurFilter=t}(),function(){var t=function(){this.eventMap={}};t.prototype.addEventListener=function(t,e,r){var i=this.eventMap[t];i||(i=this.eventMap[t]=[]),i.push({listener:e,thisObject:r})},t.prototype.removeEventListener=function(t,e,r){var i=this.eventMap[t];if(i)for(var o=0,n=i.length;n>o;o++){var a=i[o];if(a.listener==e&&a.thisObject==r){i.splice(o,1);break}}},t.prototype.dispatchEvent=function(t){this.notifyListener(t)},t.prototype.notifyListener=function(t){var e=this.eventMap[t.type];if(e)for(var r=0,i=e.length;i>r;r++){var o=e[r];o.listener.call(o.thisObject,t)}},zen.EventDispatcher=t}(),function(){var t=function(){this.type="",this.target=null};t.dispatchEvent=function(e,r){var i=new t;i.type=r,i.target=e,e.dispatchEvent(i)},zen.Event=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.pageX=0,this.pageY=0,this.localX=0,this.localY=0};zen.inherit(t,zen.Event),t.dispatchEvent=function(e,r,i,o){var n=new t;n.type=r,n.target=e,n.pageX=i,n.pageY=o;var a=e.getInvertedConcatenatedMatrix(),s=a.a*i+a.c*o+a.tx,h=a.b*i+a.d*o+a.ty;n.localX=s,n.localY=h,e.dispatchEvent(n)},t.TOUCH_TAP="touch_tap",t.TOUCH_BEGIN="touch_begin",t.TOUCH_MOVE="touch_move",t.TOUCH_END="touch_end",t.TOUCH_RELEASE_OUTSIDE="touch_release_outside",zen.TouchEvent=t}(),function(){var t=function(){t.superClass.constructor.call(this),this.loadedCount=0,this.totalCount=0};zen.inherit(t,zen.Event),t.dispatchEvent=function(e,r,i,o){var n=new t;n.type=r,n.target=e,n.loadedCount=i,n.totalCount=o,e.dispatchEvent(n)},t.LOAD_BEGIN="load_begin",t.LOAD_PROCESSING="load_processing",t.LOAD_FINISH="load_finish",zen.LoadEvent=t}(),function(){var t=zen.BLEND_MODE,e=function(){e.superClass.constructor.call(this),this.type=null,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.anchorX=0,this.anchorY=0,this.transform=new zen.Matrix,this.parentTransform=new zen.Matrix,this.width=0,this.height=0,this.filters=[],this.blend=t.SOURCE_OVER,this.mask=null,this._contentBounds=new zen.Rectangle,this.parent=null,this.concatenatedMatrix=new zen.Matrix,this.invertConcatenatedMatrix=new zen.Matrix};zen.inherit(e,zen.EventDispatcher),e.prototype.getCoords=function(){},e.prototype.getProps=function(){},e.prototype.getIndices=function(){},e.prototype.getTransformMatrix=function(){return this.transform.setTransform(this.x,this.y,this.scaleX,this.scaleY,this.rotation,this.anchorX*this.width,this.anchorY*this.height),this.transform},e.prototype.getContentBounds=function(){var t=this._contentBounds;return t.x=0,t.y=0,t.width=this.width,t.height=this.height,this._contentBounds},e.prototype.hitTest=function(t,e){var r=this.getContentBounds(),i=this.getInvertedConcatenatedMatrix(),o=i.a*t+i.c*e+i.tx,n=i.b*t+i.d*e+i.ty;return r.contains(o,n)?this:null},e.prototype.dispatchEvent=function(t){for(var e=this.getPropagationList(),r=0;r<e.length;r++){var i=e[r];i.notifyListener(t)}},e.prototype.getPropagationList=function(){for(var t=[],e=this;e;)t.push(e),e=e.parent;return t},e.prototype.getConcatenatedMatrix=function(){return this.concatenatedMatrix.copy(this.getTransformMatrix()),this.parent&&this.concatenatedMatrix.prepend(this.parent.getConcatenatedMatrix()),this.concatenatedMatrix},e.prototype.getInvertedConcatenatedMatrix=function(){return this.invertConcatenatedMatrix.copy(this.getConcatenatedMatrix()),this.invertConcatenatedMatrix.invert(),this.invertConcatenatedMatrix},zen.DisplayObject=e}(),function(){var t=zen.DISPLAY_TYPE,e=function(){e.superClass.constructor.call(this),this.type=t.CONTAINER,this.children=[]};zen.inherit(e,zen.DisplayObject),e.prototype.addChild=function(t){this.children.push(t),t.parent=this},e.prototype.removeChild=function(t){for(var e=0;e<this.children.length;){var r=this.children[e];if(r==t){this.children.splice(e,1),r.parent=null;break}e++}},e.prototype.hitTest=function(t,r){for(var i=null,o=this.children.length-1;o>=0;o--){var n=this.children[o];if(i=n.hitTest(t,r))break}return i||e.superClass.hitTest.call(this)},zen.DisplayObjectContainer=e}(),function(){var t=zen.DISPLAY_TYPE,e=function(){e.superClass.constructor.call(this),this.type=t.SPRITE,this.texture=null,this.defaultSourceFrame=!0,this.sourceFrame=new zen.Rectangle};zen.inherit(e,zen.DisplayObject),e.prototype.setSourceFrame=function(t,e,r,i){var o=this.sourceFrame;1==arguments.length?o.copy(t):o.set(t,e,r,i),this.defaultSourceFrame=!1},e.prototype.getCoords=function(){var t=[0,0,0+this.width,0,0+this.width,0+this.height,0,0+this.height];return t},e.prototype.getProps=function(){var t;if(this.defaultSourceFrame)t=[0,0,1,0,1,1,0,1];else{var e=this.texture;if(e&&e.isInit){textureWidth=e.width,textureHeight=e.height;var r=this.sourceFrame,i=r.x/textureWidth,o=r.y/textureHeight,n=r.width/textureWidth,a=r.height/textureHeight;t=[i,o,i+n,o,i+n,o+a,i,o+a]}else t=[0,0,0,0,0,0,0,0]}return t},e.prototype.getIndices=function(){return[0,1,2,2,3,0]},zen.Sprite=e}(),function(){var t=zen.DISPLAY_TYPE,e=function(){e.superClass.constructor.call(this),this.type=t.RECT,this.color=0};zen.inherit(e,zen.DisplayObject),e.prototype.getCoords=function(){var t=[0,0,0+this.width,0,0+this.width,0+this.height,0,0+this.height];return t},e.prototype.getProps=function(){var t=[0,0,0,0,0,0,0,0];return t},e.prototype.getIndices=function(){return[0,1,2,2,3,0]},zen.Rect=e}(),function(){var t=zen.DISPLAY_TYPE,e=document.createElement("canvas"),r=e.getContext("2d"),i=function(e){i.superClass.constructor.call(this),this.type=t.TEXT,this.texture=new zen.Texture(e),this.$text="",this.$fontColor=16711680,this.$fontSize=24,this.$fontFamily="Arial",this.dirty=!0};zen.inherit(i,zen.DisplayObject),Object.defineProperties(i.prototype,{text:{get:function(){return this.$text},set:function(t){this.$text=t,this.dirty=!0}},fontColor:{get:function(){return this.$fontColor},set:function(t){this.$fontColor=t,this.dirty=!0}},fontSize:{get:function(){return this.$fontSize},set:function(t){this.$fontSize=t,this.dirty=!0}},fontFamily:{get:function(){return this.$fontFamily},set:function(t){this.$fontFamily=t,this.dirty=!0}}}),i.prototype.getCoords=function(){if(this.dirty){var t=r;t.font=this.$fontSize+"px "+this.$fontFamily,this.width=t.measureText(this.$text).width,this.height=1.4*this.$fontSize}var e=[0,0,0+this.width,0,0+this.width,0+this.height,0,0+this.height];return e},i.prototype.getProps=function(){var t=[0,0,1,0,1,1,0,1];return t},i.prototype.getIndices=function(){return[0,1,2,2,3,0]},i.prototype.updateTexture=function(){var t=e,i=r;i.font=this.$fontSize+"px "+this.$fontFamily;var o=i.measureText(this.$text).width||1,n=1.4*this.$fontSize||1;t.width=o,t.height=n,i.clearRect(0,0,o,n),i.font=this.$fontSize+"px "+this.$fontFamily,i.fillStyle="#"+this.$fontColor.toString(16),i.fillText(this.$text,0,this.$fontSize),this.texture.uploadImage(t,!0)},zen.Text=i}(),function(){var t=function(){this.startTime=Date.now(),this.frameCount=0,this.dom=document.createElement("div"),this.dom.style.cssText="background:rgba(0, 0, 0, 0.8);position:absolute;top:0;left:0;padding:10px;min-width:180px;height:80px;fontSize:26px;color:green"};t.prototype.update=function(t){var e=Date.now();if(e-this.startTime<1e3)this.frameCount++;else{var r=Math.min(this.frameCount+1,60);this.show(r,t||"[not input!]"),this.startTime=e,this.frameCount=0}},t.prototype.show=function(t,e){this.dom.innerHTML="FPS :"+t+"</br>DRAW:"+e},t.prototype.getDom=function(){return this.dom},zen.State=t}(),function(){var t=function(t,e){this.canvas=t,this.rootTarget=e,this.touchDownTarget={},this.useTouchesCount=0,this.maxTouches=6,this.scaleX=1,this.scaleY=1};t.prototype.addListeners=function(){window.navigator.msPointerEnabled?this.addMSPointerListener():zen.isMobile()?this.addTouchListener():this.addMouseListener()},t.prototype.addMSPointerListener=function(){var t=this;this.canvas.addEventListener("MSPointerDown",function(e){e.identifier=e.pointerId,t.onTouchBegin(e),t.prevent(e)},!1),this.canvas.addEventListener("MSPointerMove",function(e){e.identifier=e.pointerId,t.onTouchMove(e),t.prevent(e)},!1),this.canvas.addEventListener("MSPointerUp",function(e){e.identifier=e.pointerId,t.onTouchEnd(e),t.prevent(e)},!1)},t.prototype.addMouseListener=function(){this.canvas.addEventListener("mousedown",this.onTouchBegin.bind(this)),this.canvas.addEventListener("mousemove",this.onTouchMove.bind(this)),this.canvas.addEventListener("mouseup",this.onTouchEnd.bind(this))},t.prototype.addTouchListener=function(){var t=this;this.canvas.addEventListener("touchstart",function(e){for(var r=e.changedTouches.length,i=0;r>i;i++)t.onTouchBegin(e.changedTouches[i]);t.prevent(e)},!1),this.canvas.addEventListener("touchmove",function(e){for(var r=e.changedTouches.length,i=0;r>i;i++)t.onTouchMove(e.changedTouches[i]);t.prevent(e)},!1),this.canvas.addEventListener("touchend",function(e){for(var r=e.changedTouches.length,i=0;r>i;i++)t.onTouchEnd(e.changedTouches[i]);t.prevent(e)},!1),this.canvas.addEventListener("touchcancel",function(e){for(var r=e.changedTouches.length,i=0;r>i;i++)t.onTouchEnd(e.changedTouches[i]);t.prevent(e)},!1)},t.prototype.prevent=function(t){t.stopPropagation(),1==t.isScroll||this.canvas.userTyping||t.preventDefault()},t.prototype.onTouchBegin=function(t){if(!(this.useTouchesCount>=this.maxTouches)){var e=+t.identifier||0,r=zen.Vec2.tempVec2,i=(this.getLocation(t,r),r.x),o=r.y,n=this.rootTarget.hitTest(i,o);n&&(null==this.touchDownTarget[e]&&(this.touchDownTarget[e]=n,this.useTouchesCount++),zen.TouchEvent.dispatchEvent(n,zen.TouchEvent.TOUCH_BEGIN,i,o))}},t.prototype.onTouchMove=function(t){var e=+t.identifier||0;if(null!=this.touchDownTarget[e]){var r=zen.Vec2.tempVec2,i=(this.getLocation(t,r),r.x),o=r.y,n=this.rootTarget.hitTest(i,o);n&&zen.TouchEvent.dispatchEvent(n,zen.TouchEvent.TOUCH_MOVE,i,o)}},t.prototype.onTouchEnd=function(t){var e=+t.identifier||0;if(null!=this.touchDownTarget[e]){var r=zen.Vec2.tempVec2,i=(this.getLocation(t,r),r.x),o=r.y,n=this.rootTarget.hitTest(i,o),a=this.touchDownTarget[e];delete this.touchDownTarget[e],this.useTouchesCount--,n&&zen.TouchEvent.dispatchEvent(n,zen.TouchEvent.TOUCH_END,i,o),n==a?zen.TouchEvent.dispatchEvent(n,zen.TouchEvent.TOUCH_TAP,i,o):zen.TouchEvent.dispatchEvent(a,zen.TouchEvent.TOUCH_RELEASE_OUTSIDE,i,o)}},t.prototype.updateScale=function(t,e){this.scaleX=t,this.scaleY=e},t.prototype.getLocation=function(t,e){var r=this.canvas.getBoundingClientRect();return e.x=(t.pageX-r.left)/this.scaleX,e.y=(t.pageY-r.top)/this.scaleY,e},zen.TouchHandler=t}(),function(){var t=zen.RESOLUTION_POLICY,e=function(e,r){this.canvas=e,this.resolutionPolicy=r||t.EXACT_FIT};e.prototype.fullScreen=function(){var t=this.canvas,e=this.calculateStageSize(this.resolutionPolicy,window.innerWidth,window.innerHeight,t.width,t.height);return t.width=e.stageWidth,t.height=e.stageHeight,t.style.left=e.displayLeft+"px",t.style.top=e.displayTop+"px",t.style.width=e.displayWidth+"px",t.style.height=e.displayHeight+"px",{scaleX:e.displayWidth/e.stageWidth,scaleY:e.displayHeight/e.stageHeight}},e.prototype.calculateStageSize=function(e,r,i,o,n){var a=o,s=n,h=0,c=0,u=r,l=i,d=u/a,p=l/s;switch(e){case t.EXACT_FIT:break;case t.SHOW_ALL:d>p?(u=Math.round(a*p),h=Math.round((r-u)/2)):(l=Math.round(s*d),c=Math.round((i-l)/2));break;case t.NO_BORDER:d>p?(l=Math.round(s*d),c=Math.round(i-l)):u=Math.round(a*p);break;case t.FIXED_WIDTH:s=Math.round(i/d);break;case t.FIXED_HEIGHT:a=Math.round(r/p)}return{stageWidth:a,stageHeight:s,displayLeft:h,displayTop:c,displayWidth:u,displayHeight:l}},zen.ScreenAdapter=e}(),function(){var t=function(){t.superClass.constructor.call(this),this.loadedCount=0,this.totalCount=0,this.cache=[],this.resources={}};zen.inherit(t,zen.EventDispatcher),t.prototype.add=function(t){return t.length||0==t.length?this.cache=this.cache.concat(t):this.cache.push(t),this},t.prototype.load=function(){this.totalCount=this.cache.length,this.loadedCount=0,zen.LoadEvent.dispatchEvent(this,zen.LoadEvent.LOAD_BEGIN,this.loadedCount,this.totalCount),this._load()},t.prototype._load=function(){var t=this.cache.shift();if(t)switch(t.type){case"image":var e=new Image;e.onload=function(){this.resources[t.name]=e,this.loadedCount++,zen.LoadEvent.dispatchEvent(this,zen.LoadEvent.LOAD_PROCESSING,this.loadedCount,this.totalCount),this._load()}.bind(this),e.src=t.src;break;case"json":var r=new XMLHttpRequest;r.onreadystatechange=function(e){4==e.target.readyState&&(this.resources[t.name]=JSON.parse(e.target.response),this.loadedCount++,zen.LoadEvent.dispatchEvent(this,zen.LoadEvent.LOAD_PROCESSING,this.loadedCount,this.totalCount),this._load())}.bind(this),r.open("GET",t.src,!0),r.send();break;default:console.warn("unknow resource type!"),this._load()}else zen.LoadEvent.dispatchEvent(this,zen.LoadEvent.LOAD_FINISH,this.loadedCount,this.totalCount)},t.prototype.getRes=function(t){var e=this.resources[t];return e},t.prototype.clear=function(){this.resources={}},zen.Loader=t}();